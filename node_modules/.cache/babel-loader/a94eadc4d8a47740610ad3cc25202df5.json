{"ast":null,"code":"var _jsxFileName = \"/Users/rkarnik/Documents/personal/mayuri_code/breakless-react/src/components/files/ViewFiles.js\";\nimport React, { Component } from 'react';\nimport { Link } from \"react-router-dom\";\nimport { MDBTable, MDBTableBody, MDBTableHead } from 'mdbreact';\nimport { connect } from \"react-redux\";\nimport appConfig from \"../../config/app-config\";\nimport request from \"request\";\nimport './ViewFiles.css';\nimport cognitoUtils from \"../../lib/cognitoUtils\";\n\nconst uuid = require('uuidv4').default;\n\nconst mapStateToProps = state => {\n  return {\n    session: state.session\n  };\n};\n\nclass ViewFiles extends Component {\n  constructor(props, context) {\n    super(props, context);\n\n    this.onSignOut = e => {\n      e.preventDefault();\n      cognitoUtils.signOutCognitoSession();\n    };\n\n    this.getColumnKeys = function () {\n      let columNames = [\"First Name\", \"Last Name\", \"Upload Time\", \"Updated Time\", \"Description\", \"File Name\"];\n      return columNames;\n    };\n\n    this.getDataKeys = function () {\n      let dataKeys = [\"first_name\", \"last_name\", \"file_uploaded_at\", \"file_updated_at\", \"file_description\", \"user_file_name\"];\n      return dataKeys;\n    };\n\n    this.getHeader = function () {\n      var keys = this.getColumnKeys();\n      return keys.map((key, index) => {\n        return React.createElement(\"th\", {\n          key: key,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 88\n          },\n          __self: this\n        }, key.toUpperCase());\n      });\n    };\n\n    this.getRowsData = function () {\n      console.log(\"CALLING getRowsData\");\n      let isAPICallDone = this.state.apiStatus; // console.log(\"getRowsData myItems \",myItems);\n\n      console.log(\"isAPICallDone  \", isAPICallDone);\n\n      if (isAPICallDone === \"SUCCESS\") {\n        let myItems = JSON.parse(this.state.apiResponse);\n        let keys = this.getDataKeys();\n        console.log(\"INSIDE IF isAPICallDone getRowsData myItems length \", myItems.length);\n        console.log(\"INSIDE IF isAPICallDone getRowsData myItems  \", myItems);\n        return myItems.map((row, index) => {\n          console.log(\"row is \", row);\n          return React.createElement(\"tr\", {\n            key: index,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 112\n            },\n            __self: this\n          }, React.createElement(RenderRow, {\n            key: index,\n            data: row,\n            keys: keys,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 112\n            },\n            __self: this\n          }));\n        }); // myItems.map((myItem) => {\n        //     console.log(\"********* Iterating getRowsData myItem \",myItem);\n        // });\n      } else {\n        console.log(\" *********** EMPTY EMPTY ROW CREATED\");\n        return React.createElement(\"tr\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 121\n          },\n          __self: this\n        });\n      }\n    };\n\n    this.state = {\n      apiStatus: 'Not called',\n      apiResponse: []\n    };\n    console.log(\"ViewFiles props \", props.location);\n    console.log(\"ViewFiles this.state \", this.state);\n    this.getHeader = this.getHeader.bind(this);\n    this.getRowsData = this.getRowsData.bind(this);\n    this.getColumnKeys = this.getColumnKeys.bind(this);\n    this.getDataKeys = this.getDataKeys.bind(this); // this.state = {\n    //     selectedFile: null,\n    //     typedText:'',\n    //     isUploadSuccess:'false'\n    //\n    // }\n  }\n\n  componentDidMount() {\n    if (this.props.session.isLoggedIn) {\n      // Call the API server GET /users endpoint with our JWT access token\n      console.log(\"ViewFiles componentDidMount this.props.session.credentials.idToken \", this.props.session.credentials.idToken);\n      const options = {\n        url: \"\".concat(appConfig.apiUri, \"/file_details\"),\n        headers: {\n          Authorization: \"Bearer \".concat(this.props.session.credentials.idToken)\n        }\n      };\n      this.setState({\n        apiStatus: 'Loading...'\n      });\n      request.get(options, (err, resp, body) => {\n        let apiStatus, apiResponse;\n\n        if (err) {\n          // is API server started and reachable?\n          apiStatus = 'Unable to reach API';\n          console.error(apiStatus + ': ' + err);\n        } else if (resp.statusCode !== 200) {\n          // API returned an error\n          apiStatus = 'Error response received';\n          apiResponse = body;\n          console.error(apiStatus + ': ' + JSON.stringify(resp));\n        } else {\n          apiStatus = 'SUCCESS';\n          apiResponse = body;\n          console.log(\"ViewFIles GET FILES API RESPONSE \", body); // this.setState({apiStatus:\"SUCCESS\",apiResponse:body});\n\n          console.log(\"ViewFIles componentDidMount state \", this.state);\n        }\n\n        this.setState({\n          apiStatus: apiStatus,\n          apiResponse: body\n        }); // this.setState({ apiStatus, apiResponse })\n      });\n    }\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      className: \"view-body\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 128\n      },\n      __self: this\n    }, this.props.session.isLoggedIn ? React.createElement(\"div\", {\n      className: \"container\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 130\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"row\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 131\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"col-md-3\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 132\n      },\n      __self: this\n    }, React.createElement(Link, {\n      to: \"/\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 133\n      },\n      __self: this\n    }, \"Home\")), React.createElement(\"div\", {\n      className: \"col-md-3\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 135\n      },\n      __self: this\n    }, React.createElement(Link, {\n      to: \"/files/upload\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 136\n      },\n      __self: this\n    }, \"Upload File\")), React.createElement(\"div\", {\n      className: \"col-md-3\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 138\n      },\n      __self: this\n    }, React.createElement(Link, {\n      to: \"/files/update\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 139\n      },\n      __self: this\n    }, \"Update Existing File\"))), React.createElement(MDBTable, {\n      className: \"table table-bordered\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 142\n      },\n      __self: this\n    }, React.createElement(MDBTableHead, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 143\n      },\n      __self: this\n    }, React.createElement(\"tr\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 144\n      },\n      __self: this\n    }, this.getHeader())), React.createElement(MDBTableBody, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 148\n      },\n      __self: this\n    }, this.getRowsData())), React.createElement(\"a\", {\n      className: \"Home-link\",\n      href: \"#\",\n      onClick: this.onSignOut,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 152\n      },\n      __self: this\n    }, \"Sign out\")) : React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 155\n      },\n      __self: this\n    }, React.createElement(\"p\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 156\n      },\n      __self: this\n    }, \"You are not logged in.\"), React.createElement(\"a\", {\n      className: \"Home-link\",\n      href: cognitoUtils.getCognitoSignInUri(),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 157\n      },\n      __self: this\n    }, \"Sign in\")));\n  }\n\n}\n\nconst RenderRow = props => {\n  console.log(\"RenderRow props \", props);\n  return props.keys.map((key, index) => {\n    console.log(\"props.data[key] \", props.data[key]);\n    console.log(\"key \", key);\n\n    if (key === 'user_file_name') {\n      let downloadUrl = appConfig.cloudfrontUri + props.data['unique_file_name'];\n      console.log(\"downloadUrl = \", downloadUrl);\n      return React.createElement(\"td\", {\n        key: uuid(),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 173\n        },\n        __self: this\n      }, React.createElement(\"a\", {\n        href: downloadUrl,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 173\n        },\n        __self: this\n      }, \" \", props.data[key]));\n    } else return React.createElement(\"td\", {\n      key: uuid(),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 175\n      },\n      __self: this\n    }, props.data[key]);\n  });\n};\n\nexport default connect(mapStateToProps)(ViewFiles);","map":{"version":3,"sources":["/Users/rkarnik/Documents/personal/mayuri_code/breakless-react/src/components/files/ViewFiles.js"],"names":["React","Component","Link","MDBTable","MDBTableBody","MDBTableHead","connect","appConfig","request","cognitoUtils","uuid","require","default","mapStateToProps","state","session","ViewFiles","constructor","props","context","onSignOut","e","preventDefault","signOutCognitoSession","getColumnKeys","columNames","getDataKeys","dataKeys","getHeader","keys","map","key","index","toUpperCase","getRowsData","console","log","isAPICallDone","apiStatus","myItems","JSON","parse","apiResponse","length","row","location","bind","componentDidMount","isLoggedIn","credentials","idToken","options","url","apiUri","headers","Authorization","setState","get","err","resp","body","error","statusCode","stringify","render","getCognitoSignInUri","RenderRow","data","downloadUrl","cloudfrontUri"],"mappings":";AAAA,OAAOA,KAAP,IAAeC,SAAf,QAA+B,OAA/B;AACA,SAAQC,IAAR,QAAmB,kBAAnB;AACA,SAAQC,QAAR,EAAkBC,YAAlB,EAAgCC,YAAhC,QAAmD,UAAnD;AACA,SAAQC,OAAR,QAAsB,aAAtB;AACA,OAAOC,SAAP,MAAsB,yBAAtB;AACA,OAAOC,OAAP,MAAoB,SAApB;AACA,OAAO,iBAAP;AACA,OAAOC,YAAP,MAAyB,wBAAzB;;AAEA,MAAMC,IAAI,GAAGC,OAAO,CAAC,QAAD,CAAP,CAAkBC,OAA/B;;AACA,MAAMC,eAAe,GAAGC,KAAK,IAAI;AAC7B,SAAO;AAACC,IAAAA,OAAO,EAAED,KAAK,CAACC;AAAhB,GAAP;AACH,CAFD;;AAIA,MAAMC,SAAN,SAAwBf,SAAxB,CAAkC;AAC9BgB,EAAAA,WAAW,CAACC,KAAD,EAAQC,OAAR,EAAiB;AACxB,UAAMD,KAAN,EAAaC,OAAb;;AADwB,SAiB5BC,SAjB4B,GAiBfC,CAAD,IAAO;AACfA,MAAAA,CAAC,CAACC,cAAF;AACAb,MAAAA,YAAY,CAACc,qBAAb;AACH,KApB2B;;AAAA,SA2D5BC,aA3D4B,GA2DZ,YAAY;AACxB,UAAIC,UAAU,GAAG,CAAC,YAAD,EAAe,WAAf,EAA4B,aAA5B,EAA2C,cAA3C,EAA2D,aAA3D,EAA0E,WAA1E,CAAjB;AACA,aAAOA,UAAP;AACH,KA9D2B;;AAAA,SAgE5BC,WAhE4B,GAgEd,YAAY;AACtB,UAAIC,QAAQ,GAAG,CAAC,YAAD,EAAe,WAAf,EAA4B,kBAA5B,EAAgD,iBAAhD,EAAmE,kBAAnE,EAAuF,gBAAvF,CAAf;AACA,aAAOA,QAAP;AACH,KAnE2B;;AAAA,SAqE5BC,SArE4B,GAqEhB,YAAY;AACpB,UAAIC,IAAI,GAAG,KAAKL,aAAL,EAAX;AACA,aAAOK,IAAI,CAACC,GAAL,CAAS,CAACC,GAAD,EAAMC,KAAN,KAAgB;AAC5B,eAAO;AAAI,UAAA,GAAG,EAAED,GAAT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAAeA,GAAG,CAACE,WAAJ,EAAf,CAAP;AACH,OAFM,CAAP;AAGH,KA1E2B;;AAAA,SAmF5BC,WAnF4B,GAmFd,YAAY;AACtBC,MAAAA,OAAO,CAACC,GAAR,CAAY,qBAAZ;AACA,UAAIC,aAAa,GAAG,KAAKvB,KAAL,CAAWwB,SAA/B,CAFsB,CAItB;;AACAH,MAAAA,OAAO,CAACC,GAAR,CAAY,iBAAZ,EAA+BC,aAA/B;;AACA,UAAIA,aAAa,KAAK,SAAtB,EAAiC;AAC7B,YAAIE,OAAO,GAAGC,IAAI,CAACC,KAAL,CAAW,KAAK3B,KAAL,CAAW4B,WAAtB,CAAd;AACA,YAAIb,IAAI,GAAG,KAAKH,WAAL,EAAX;AACAS,QAAAA,OAAO,CAACC,GAAR,CAAY,qDAAZ,EAAmEG,OAAO,CAACI,MAA3E;AACAR,QAAAA,OAAO,CAACC,GAAR,CAAY,+CAAZ,EAA6DG,OAA7D;AACA,eAAOA,OAAO,CAACT,GAAR,CAAY,CAACc,GAAD,EAAMZ,KAAN,KAAgB;AAC/BG,UAAAA,OAAO,CAACC,GAAR,CAAY,SAAZ,EAAuBQ,GAAvB;AACA,iBAAO;AAAI,YAAA,GAAG,EAAEZ,KAAT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aAAgB,oBAAC,SAAD;AAAW,YAAA,GAAG,EAAEA,KAAhB;AAAuB,YAAA,IAAI,EAAEY,GAA7B;AAAkC,YAAA,IAAI,EAAEf,IAAxC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAAhB,CAAP;AACH,SAHM,CAAP,CAL6B,CAS7B;AACA;AACA;AAGH,OAdD,MAcO;AACHM,QAAAA,OAAO,CAACC,GAAR,CAAY,sCAAZ;AACA,eAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAAP;AACH;AAEJ,KA5G2B;;AAExB,SAAKtB,KAAL,GAAa;AAACwB,MAAAA,SAAS,EAAE,YAAZ;AAAyBI,MAAAA,WAAW,EAAC;AAArC,KAAb;AACAP,IAAAA,OAAO,CAACC,GAAR,CAAY,kBAAZ,EAAgClB,KAAK,CAAC2B,QAAtC;AACAV,IAAAA,OAAO,CAACC,GAAR,CAAY,uBAAZ,EAAqC,KAAKtB,KAA1C;AACA,SAAKc,SAAL,GAAiB,KAAKA,SAAL,CAAekB,IAAf,CAAoB,IAApB,CAAjB;AACA,SAAKZ,WAAL,GAAmB,KAAKA,WAAL,CAAiBY,IAAjB,CAAsB,IAAtB,CAAnB;AACA,SAAKtB,aAAL,GAAqB,KAAKA,aAAL,CAAmBsB,IAAnB,CAAwB,IAAxB,CAArB;AACA,SAAKpB,WAAL,GAAmB,KAAKA,WAAL,CAAiBoB,IAAjB,CAAsB,IAAtB,CAAnB,CARwB,CASxB;AACA;AACA;AACA;AACA;AACA;AACH;;AAODC,EAAAA,iBAAiB,GAAG;AAEhB,QAAI,KAAK7B,KAAL,CAAWH,OAAX,CAAmBiC,UAAvB,EAAmC;AAC/B;AACAb,MAAAA,OAAO,CAACC,GAAR,CAAY,qEAAZ,EAAmF,KAAKlB,KAAL,CAAWH,OAAX,CAAmBkC,WAAnB,CAA+BC,OAAlH;AACA,YAAMC,OAAO,GAAG;AACZC,QAAAA,GAAG,YAAK7C,SAAS,CAAC8C,MAAf,kBADS;AAEZC,QAAAA,OAAO,EAAE;AACLC,UAAAA,aAAa,mBAAY,KAAKrC,KAAL,CAAWH,OAAX,CAAmBkC,WAAnB,CAA+BC,OAA3C;AADR;AAFG,OAAhB;AAOA,WAAKM,QAAL,CAAc;AAAClB,QAAAA,SAAS,EAAE;AAAZ,OAAd;AACA9B,MAAAA,OAAO,CAACiD,GAAR,CAAYN,OAAZ,EAAqB,CAACO,GAAD,EAAMC,IAAN,EAAYC,IAAZ,KAAqB;AACtC,YAAItB,SAAJ,EAAeI,WAAf;;AACA,YAAIgB,GAAJ,EAAS;AACL;AACApB,UAAAA,SAAS,GAAG,qBAAZ;AACAH,UAAAA,OAAO,CAAC0B,KAAR,CAAcvB,SAAS,GAAG,IAAZ,GAAmBoB,GAAjC;AACH,SAJD,MAIO,IAAIC,IAAI,CAACG,UAAL,KAAoB,GAAxB,EAA6B;AAChC;AACAxB,UAAAA,SAAS,GAAG,yBAAZ;AACAI,UAAAA,WAAW,GAAGkB,IAAd;AACAzB,UAAAA,OAAO,CAAC0B,KAAR,CAAcvB,SAAS,GAAG,IAAZ,GAAmBE,IAAI,CAACuB,SAAL,CAAeJ,IAAf,CAAjC;AACH,SALM,MAKA;AACHrB,UAAAA,SAAS,GAAG,SAAZ;AACAI,UAAAA,WAAW,GAAGkB,IAAd;AACAzB,UAAAA,OAAO,CAACC,GAAR,CAAY,mCAAZ,EAAiDwB,IAAjD,EAHG,CAIH;;AACAzB,UAAAA,OAAO,CAACC,GAAR,CAAY,oCAAZ,EAAkD,KAAKtB,KAAvD;AACH;;AACD,aAAK0C,QAAL,CAAc;AAAClB,UAAAA,SAAS,EAAEA,SAAZ;AAAuBI,UAAAA,WAAW,EAAEkB;AAApC,SAAd,EAlBsC,CAmBtC;AACH,OApBD;AAqBH;AACJ;;AAqDDI,EAAAA,MAAM,GAAG;AACL,WACI;AAAK,MAAA,SAAS,EAAC,WAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACK,KAAK9C,KAAL,CAAWH,OAAX,CAAmBiC,UAAnB,GACG;AAAK,MAAA,SAAS,EAAC,WAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACI;AAAK,MAAA,SAAS,EAAC,KAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACI;AAAK,MAAA,SAAS,EAAC,UAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACI,oBAAC,IAAD;AAAM,MAAA,EAAE,EAAC,GAAT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cADJ,CADJ,EAII;AAAK,MAAA,SAAS,EAAC,UAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACI,oBAAC,IAAD;AAAM,MAAA,EAAE,EAAC,eAAT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBADJ,CAJJ,EAOI;AAAK,MAAA,SAAS,EAAC,UAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACI,oBAAC,IAAD;AAAM,MAAA,EAAE,EAAC,eAAT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,8BADJ,CAPJ,CADJ,EAYI,oBAAC,QAAD;AAAU,MAAA,SAAS,EAAC,sBAApB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACI,oBAAC,YAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACK,KAAKpB,SAAL,EADL,CADJ,CADJ,EAMI,oBAAC,YAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACK,KAAKM,WAAL,EADL,CANJ,CAZJ,EAsBI;AAAG,MAAA,SAAS,EAAC,WAAb;AAAyB,MAAA,IAAI,EAAC,GAA9B;AAAkC,MAAA,OAAO,EAAE,KAAKd,SAAhD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAtBJ,CADH,GA0BG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gCADJ,EAEI;AAAG,MAAA,SAAS,EAAC,WAAb;AAAyB,MAAA,IAAI,EAAEX,YAAY,CAACwD,mBAAb,EAA/B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAFJ,CA3BR,CADJ;AAmCH;;AAnJ6B;;AAsJlC,MAAMC,SAAS,GAAIhD,KAAD,IAAW;AACzBiB,EAAAA,OAAO,CAACC,GAAR,CAAY,kBAAZ,EAAgClB,KAAhC;AACA,SAAOA,KAAK,CAACW,IAAN,CAAWC,GAAX,CAAe,CAACC,GAAD,EAAMC,KAAN,KAAgB;AAClCG,IAAAA,OAAO,CAACC,GAAR,CAAY,kBAAZ,EAAgClB,KAAK,CAACiD,IAAN,CAAWpC,GAAX,CAAhC;AACAI,IAAAA,OAAO,CAACC,GAAR,CAAY,MAAZ,EAAoBL,GAApB;;AACA,QAAIA,GAAG,KAAK,gBAAZ,EAA8B;AAC1B,UAAIqC,WAAW,GAAG7D,SAAS,CAAC8D,aAAV,GAA0BnD,KAAK,CAACiD,IAAN,CAAW,kBAAX,CAA5C;AACAhC,MAAAA,OAAO,CAACC,GAAR,CAAY,gBAAZ,EAA6BgC,WAA7B;AACA,aAAO;AAAI,QAAA,GAAG,EAAE1D,IAAI,EAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAiB;AAAG,QAAA,IAAI,EAAE0D,WAAT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAAwBlD,KAAK,CAACiD,IAAN,CAAWpC,GAAX,CAAxB,CAAjB,CAAP;AACH,KAJD,MAKI,OAAO;AAAI,MAAA,GAAG,EAAErB,IAAI,EAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAkBQ,KAAK,CAACiD,IAAN,CAAWpC,GAAX,CAAlB,CAAP;AACP,GATM,CAAP;AAUH,CAZD;;AAeA,eAAezB,OAAO,CAACO,eAAD,CAAP,CAAyBG,SAAzB,CAAf","sourcesContent":["import React, {Component} from 'react';\nimport {Link} from \"react-router-dom\";\nimport {MDBTable, MDBTableBody, MDBTableHead} from 'mdbreact';\nimport {connect} from \"react-redux\";\nimport appConfig from \"../../config/app-config\";\nimport request from \"request\";\nimport './ViewFiles.css'\nimport cognitoUtils from \"../../lib/cognitoUtils\";\n\nconst uuid = require('uuidv4').default;\nconst mapStateToProps = state => {\n    return {session: state.session}\n}\n\nclass ViewFiles extends Component {\n    constructor(props, context) {\n        super(props, context);\n        this.state = {apiStatus: 'Not called',apiResponse:[]}\n        console.log(\"ViewFiles props \", props.location);\n        console.log(\"ViewFiles this.state \", this.state);\n        this.getHeader = this.getHeader.bind(this);\n        this.getRowsData = this.getRowsData.bind(this);\n        this.getColumnKeys = this.getColumnKeys.bind(this);\n        this.getDataKeys = this.getDataKeys.bind(this);\n        // this.state = {\n        //     selectedFile: null,\n        //     typedText:'',\n        //     isUploadSuccess:'false'\n        //\n        // }\n    }\n\n    onSignOut = (e) => {\n        e.preventDefault()\n        cognitoUtils.signOutCognitoSession()\n    }\n\n    componentDidMount() {\n\n        if (this.props.session.isLoggedIn) {\n            // Call the API server GET /users endpoint with our JWT access token\n            console.log(\"ViewFiles componentDidMount this.props.session.credentials.idToken \", this.props.session.credentials.idToken);\n            const options = {\n                url: `${appConfig.apiUri}/file_details`,\n                headers: {\n                    Authorization: `Bearer ${this.props.session.credentials.idToken}`\n                }\n            }\n\n            this.setState({apiStatus: 'Loading...'});\n            request.get(options, (err, resp, body) => {\n                let apiStatus, apiResponse\n                if (err) {\n                    // is API server started and reachable?\n                    apiStatus = 'Unable to reach API'\n                    console.error(apiStatus + ': ' + err)\n                } else if (resp.statusCode !== 200) {\n                    // API returned an error\n                    apiStatus = 'Error response received'\n                    apiResponse = body\n                    console.error(apiStatus + ': ' + JSON.stringify(resp))\n                } else {\n                    apiStatus = 'SUCCESS'\n                    apiResponse = body\n                    console.log(\"ViewFIles GET FILES API RESPONSE \", body);\n                    // this.setState({apiStatus:\"SUCCESS\",apiResponse:body});\n                    console.log(\"ViewFIles componentDidMount state \", this.state);\n                }\n                this.setState({apiStatus: apiStatus, apiResponse: body})\n                // this.setState({ apiStatus, apiResponse })\n            })\n        }\n    }\n\n    getColumnKeys = function () {\n        let columNames = [\"First Name\", \"Last Name\", \"Upload Time\", \"Updated Time\", \"Description\", \"File Name\"];\n        return columNames;\n    }\n\n    getDataKeys = function () {\n        let dataKeys = [\"first_name\", \"last_name\", \"file_uploaded_at\", \"file_updated_at\", \"file_description\", \"user_file_name\"];\n        return dataKeys;\n    }\n\n    getHeader = function () {\n        var keys = this.getColumnKeys();\n        return keys.map((key, index) => {\n            return <th key={key}>{key.toUpperCase()}</th>\n        })\n    }\n\n    // getRowsData = function(){\n    //     var items = this.props.data;\n    //     var keys = this.getColumnKeys();\n    //     return items.map((row, index)=>{\n    //         return <tr key={index}><RenderRow key={index} data={row} keys={keys}/></tr>\n    //     })\n    // }\n    getRowsData = function () {\n        console.log(\"CALLING getRowsData\");\n        let isAPICallDone = this.state.apiStatus;\n\n        // console.log(\"getRowsData myItems \",myItems);\n        console.log(\"isAPICallDone  \", isAPICallDone);\n        if (isAPICallDone === \"SUCCESS\") {\n            let myItems = JSON.parse(this.state.apiResponse);\n            let keys = this.getDataKeys();\n            console.log(\"INSIDE IF isAPICallDone getRowsData myItems length \", myItems.length);\n            console.log(\"INSIDE IF isAPICallDone getRowsData myItems  \", myItems);\n            return myItems.map((row, index) => {\n                console.log(\"row is \", row);\n                return <tr key={index}><RenderRow key={index} data={row} keys={keys}/></tr>\n            })\n            // myItems.map((myItem) => {\n            //     console.log(\"********* Iterating getRowsData myItem \",myItem);\n            // });\n\n\n        } else {\n            console.log(\" *********** EMPTY EMPTY ROW CREATED\");\n            return <tr></tr>;\n        }\n\n    }\n\n    render() {\n        return (\n            <div className=\"view-body\">\n                {this.props.session.isLoggedIn ? (\n                    <div className=\"container\">\n                        <div className=\"row\">\n                            <div className=\"col-md-3\">\n                                <Link to=\"/\">Home</Link>\n                            </div>\n                            <div className=\"col-md-3\">\n                                <Link to=\"/files/upload\">Upload File</Link>\n                            </div>\n                            <div className=\"col-md-3\">\n                                <Link to=\"/files/update\">Update Existing File</Link>\n                            </div>\n                        </div>\n                        <MDBTable className=\"table table-bordered\">\n                            <MDBTableHead>\n                                <tr>\n                                    {this.getHeader()}\n                                </tr>\n                            </MDBTableHead>\n                            <MDBTableBody>\n                                {this.getRowsData()}\n                            </MDBTableBody>\n                        </MDBTable>\n                        <a className=\"Home-link\" href=\"#\" onClick={this.onSignOut}>Sign out</a>\n                    </div>\n                ) : (\n                    <div>\n                        <p>You are not logged in.</p>\n                        <a className=\"Home-link\" href={cognitoUtils.getCognitoSignInUri()}>Sign in</a>\n                    </div>\n                )}\n            </div>\n        )\n    }\n}\n\nconst RenderRow = (props) => {\n    console.log(\"RenderRow props \", props);\n    return props.keys.map((key, index) => {\n        console.log(\"props.data[key] \", props.data[key]);\n        console.log(\"key \", key);\n        if (key === 'user_file_name') {\n            let downloadUrl = appConfig.cloudfrontUri + props.data['unique_file_name'];\n            console.log(\"downloadUrl = \",downloadUrl);\n            return <td key={uuid()}><a href={downloadUrl}> {props.data[key]}</a></td>\n        } else\n            return <td key={uuid()}>{props.data[key]}</td>\n    })\n}\n\n\nexport default connect(mapStateToProps)(ViewFiles)\n"]},"metadata":{},"sourceType":"module"}